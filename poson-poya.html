<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Poson Lantern Night (Live)</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: radial-gradient(ellipse at bottom, #0a0a2a 0%, #000 100%);
      overflow: hidden;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      text-align: center;
    }
    .lantern {
      position: absolute;
      bottom: -50px;
      width: 30px;
      height: 45px;
      border-radius: 5px;
      box-shadow: 0 0 15px;
      animation: floatUp 20s linear forwards;
    }
    @keyframes floatUp {
      to {
        transform: translateY(-130vh) rotate(360deg);
        opacity: 0;
      }
    }
    .wishLabel {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      color: #fff;
      font-size: 0.7rem;
      text-shadow: 0 0 5px #000;
      white-space: nowrap;
    }
    .wishBox {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      background: rgba(255, 255, 255, 0.05);
      padding: 10px 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px #fff3;
    }
    .wishBox input, .wishBox select, .wishBox button {
      margin: 5px;
      padding: 6px 10px;
      border: none;
      border-radius: 5px;
    }
    .wishCount {
      font-size: 0.9rem;
      margin-top: 5px;
      color: #ffdd57;
    }
  </style>
</head>
<body>

<div class="wishBox">
  <input type="text" id="wishInput" placeholder="Your wish">
  <select id="colorSelect">
    <option value="#ffdd57">Gold</option>
    <option value="#ffffff">White</option>
    <option value="#ff7f50">Orange</option>
    <option value="#80dfff">Blue</option>
    <option value="#ff69b4">Pink</option>
  </select>
  <button onclick="releaseLantern()">Release</button>
  <div class="wishCount" id="wishCount">Lanterns released: 0</div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyABCCBJ_2nk0qmHijmQ4MfqWYnaZ9eZzw4",
    authDomain: "poson-poya-day-lantern-project.firebaseapp.com",
    databaseURL: "https://poson-poya-day-lantern-project-default-rtdb.firebaseio.com",
    projectId: "poson-poya-day-lantern-project",
    storageBucket: "poson-poya-day-lantern-project.appspot.com",
    messagingSenderId: "140912464253",
    appId: "1:140912464253:web:ebddf3e118d68f417a3c14"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const countRef = db.ref('lanternCount');
  const lanternsRef = db.ref('lanterns');

  // Update lantern count display live
  countRef.on('value', snap => {
    document.getElementById("wishCount").innerText = `Lanterns released: ${snap.val() || 0}`;
  });

  // Listen for new lanterns from any user
  lanternsRef.on('child_added', snapshot => {
    const { text, color, posX } = snapshot.val();
    showLantern(text, color, posX);
  });

  function releaseLantern() {
    const wishText = document.getElementById("wishInput").value.trim();
    const color = document.getElementById("colorSelect").value;
    if (!wishText) return alert("Type a wish!");

    const posX = Math.random() * 80 + 10; // 10% to 90% of viewport width

    // Push lantern data to database
    lanternsRef.push({
      text: wishText,
      color: color,
      posX: posX
    });

    // Increment total count safely
    countRef.transaction(current => (current || 0) + 1);

    // Optionally clear input
    document.getElementById("wishInput").value = "";
  }

  function showLantern(text, color, posX) {
    const lantern = document.createElement('div');
    lantern.className = 'lantern';
    lantern.style.left = posX + 'vw';
    lantern.style.background = color;
    lantern.style.boxShadow = `0 0 20px ${color}`;

    const label = document.createElement('div');
    label.className = 'wishLabel';
    label.innerText = text;

    lantern.appendChild(label);
    document.body.appendChild(lantern);

    // Remove after animation (~20s)
    setTimeout(() => { lantern.remove(); }, 20000);
  }
</script>

</body>
</html>

