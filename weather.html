<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="description" content="Premium Live Weather Dashboard for Sri Lanka">
  <title>Everything Lanka ‚Äì Weather Enhanced</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;800&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

  <style>
    /* --- 1. CORE VARIABLES --- */
    :root {
      --glass: rgba(255, 255, 255, 0.12);
      --glass-hover: rgba(255, 255, 255, 0.2);
      --border: rgba(255, 255, 255, 0.3);
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.25);
      --accent: #ffd700; /* Yellow for high contrast */
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: 'Outfit', sans-serif;
      min-height: 100vh;
      color: #fff;
      overflow-x: hidden;
      background: #0f2027; 
      transition: background 1.5s ease-in-out;
    }

    /* --- 2. DYNAMIC BACKGROUND THEMES --- */
    body.theme-clear { 
      background: linear-gradient(135deg, #2980b9, #6dd5fa, #ffffff); 
      background-size: 400% 400%; animation: gradientMove 15s ease infinite; 
    }
    body.theme-night { background: linear-gradient(to bottom, #000000, #0f2027, #2c5364); }
    body.theme-cloudy { background: linear-gradient(to bottom, #304352, #859398); }
    body.theme-rain { background: linear-gradient(to bottom, #203a43, #2c5364); }
    body.theme-thunder { background: #141E30; }

    /* Moving Clouds Overlay */
    body.theme-cloudy::before {
      content: ''; position: fixed; top: 0; left: 0; width: 200%; height: 100%;
      background: url('https://raw.githubusercontent.com/basmilius/weather-icons/master/design/fill/animation-ready/cloudy.svg'); 
      background-size: contain; opacity: 0.1; animation: drift 60s linear infinite; pointer-events: none; z-index: 0;
    }

    /* Rain Overlay */
    body.theme-rain::after {
      content: ""; position: fixed; inset: 0; z-index: 0;
      background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIzMCI+PHBhdGggZmlsbD0ibm9uZSIgc3Ryb2tlPSJyd2hhKDI1NSwyNTUsMjU1LDAuNCkiIGQ9Ik0wIDBsNSA4Ii8+PC9zdmc+');
      animation: rainFall 0.4s linear infinite; opacity: 0.7; pointer-events: none;
    }

    /* Thunder Overlay */
    body.theme-thunder::before {
      content: ""; position: fixed; inset: 0; background: #fff;
      opacity: 0; animation: lightning 5s infinite; z-index: 1; pointer-events: none;
    }

    @keyframes gradientMove { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
    @keyframes drift { from { transform: translateX(0); } to { transform: translateX(-50%); } }
    @keyframes rainFall { from { background-position: 0 0; } to { background-position: -5px 20px; } }
    @keyframes lightning { 0%, 95% { opacity: 0; } 96% { opacity: 0.3; } 97% { opacity: 0; } 98% { opacity: 0.1; } 100% { opacity: 0; } }

    /* --- 3. LAYOUT --- */
    .container {
      max-width: 1100px; margin: 0 auto; padding: 30px 20px;
      position: relative; z-index: 2; display: flex; flex-direction: column; gap: 30px;
    }

    header { text-align: center; margin-bottom: 20px; }
    h1 { 
      font-size: 3.5rem; font-weight: 800; letter-spacing: -1.5px;
      background: linear-gradient(to right, #fff, #ffd700); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      text-shadow: 0 10px 30px rgba(0,0,0,0.3); margin-bottom: 5px;
    }
    .subtitle { font-size: 1.1rem; opacity: 0.8; font-weight: 300; letter-spacing: 1px; }

    .glass-card {
      background: var(--glass); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px);
      border: 1px solid var(--border); border-radius: 24px; padding: 30px;
      box-shadow: var(--shadow); transition: transform 0.3s ease;
    }
    
    .controls-bar { display: flex; gap: 12px; margin-bottom: 20px; justify-content: center; flex-wrap: wrap; }
    select, button { padding: 14px 24px; border-radius: 50px; border: none; font-size: 1rem; cursor: pointer; }
    select { background: rgba(255,255,255,0.9); font-weight: 600; min-width: 200px; outline: none; }
    .btn-primary { background: var(--accent); color: #222; font-weight: 700; box-shadow: 0 0 20px rgba(255, 215, 0, 0.4); }
    .btn-primary:hover { transform: scale(1.05); background: #fff; }
    .btn-icon { background: rgba(255,255,255,0.2); color: #fff; backdrop-filter: blur(5px); }

    .weather-grid { display: grid; grid-template-columns: 1.5fr 1fr; gap: 20px; display: none; }
    @media(max-width: 800px) { .weather-grid { grid-template-columns: 1fr; } }

    /* HERO SECTION */
    .weather-hero { text-align: center; display: flex; flex-direction: column; justify-content: center; align-items: center; }
    .live-badge { background: #ff4757; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 800; text-transform: uppercase; margin-bottom: 15px; }
    .weather-icon { font-size: 6rem; margin: 10px 0; filter: drop-shadow(0 0 20px rgba(255,255,255,0.4)); }
    .temp-large { font-size: 5.5rem; font-weight: 800; line-height: 1; margin-left: 15px; }
    
    /* WEATHER DESCRIPTION TEXT (FIXED) */
    .condition-text { 
      font-size: 2rem; /* Bigger */
      font-weight: 700; /* Bolder */
      color: var(--accent); /* Yellow */
      text-shadow: 0 2px 10px rgba(0,0,0,0.5); /* Shadow for readability */
      margin-top: 10px;
      text-transform: capitalize;
    }

    .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    .stat-box { background: rgba(0,0,0,0.2); border-radius: 16px; padding: 15px; display: flex; flex-direction: column; justify-content: center; }
    .stat-label { font-size: 0.85rem; opacity: 0.7; margin-bottom: 5px; }
    .stat-val { font-size: 1.25rem; font-weight: 700; }

    .chart-container { margin-top: 20px; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.15); }
    svg.sparkline { width: 100%; height: 80px; overflow: visible; }
    .spark-line { fill: none; stroke: var(--accent); stroke-width: 3; stroke-linecap: round; filter: drop-shadow(0 0 8px var(--accent)); }
    .spark-fill { fill: rgba(255, 215, 0, 0.1); stroke: none; }
    footer { text-align: center; margin-top: 40px; opacity: 0.6; font-size: 0.9rem; }
  </style>
</head>
<body>

  <div class="container">
    <header class="animate__animated animate__fadeInDown">
      <h1>Everything Lanka</h1>
      <div class="subtitle">Live Weather Intelligence Center</div>
      <div id="clock" style="margin-top:10px; font-weight:700; opacity:0.8">--:--:--</div>
    </header>

    <div class="controls-bar animate__animated animate__fadeInUp" style="animation-delay: 0.2s;">
      <select id="districts">
        <option disabled selected>Select District</option>
        <option>Colombo</option><option>Gampaha</option><option>Kalutara</option>
        <option>Kandy</option><option>Matale</option><option>Nuwara Eliya</option>
        <option>Galle</option><option>Matara</option><option>Hambantota</option>
        <option>Jaffna</option><option>Kilinochchi</option><option>Mannar</option>
        <option>Vavuniya</option><option>Mullaitivu</option><option>Trincomalee</option>
        <option>Batticaloa</option><option>Ampara</option><option>Monaragala</option>
        <option>Badulla</option><option>Ratnapura</option><option>Kegalle</option>
        <option>Anuradhapura</option><option>Polonnaruwa</option><option>Puttalam</option>
        <option>Kurunegala</option>
      </select>
      <button class="btn-primary" id="getWeatherBtn">Get Weather</button>
      <button class="btn-icon" id="geoBtn" title="Use My Location">üìç</button>
    </div>

    <main id="weatherContainer" class="glass-card animate__animated animate__zoomIn" style="display:none">
      <div class="weather-grid" style="display:grid;">
        <div class="weather-hero">
          <span class="live-badge">Live Report</span>
          <div id="wIcon" class="weather-icon animate__animated animate__rubberBand">üå§Ô∏è</div>
          <div class="temp-large"><span id="wTemp">--</span>¬∞</div>
          <div class="condition-text" id="wDesc">Loading...</div>
          <div style="margin-top:5px; font-size:0.9rem; opacity:0.7" id="wLoc">--</div>
        </div>

        <div class="stats-grid">
          <div class="stat-box"><span class="stat-label">Feels Like</span><span class="stat-val" id="wFeels">--¬∞</span></div>
          <div class="stat-box"><span class="stat-label">Humidity</span><span class="stat-val" id="wHum">--%</span></div>
          <div class="stat-box"><span class="stat-label">Rain Chance</span><span class="stat-val" id="wRain">--%</span></div>
          <div class="stat-box"><span class="stat-label">Wind Speed</span><span class="stat-val" id="wWind">-- <small>km/h</small></span></div>
          <div class="stat-box"><span class="stat-label">Sunrise</span><span class="stat-val" id="wSunrise">--:--</span></div>
          <div class="stat-box"><span class="stat-label">Sunset</span><span class="stat-val" id="wSunset">--:--</span></div>
        </div>
      </div>

      <div class="chart-container">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px; opacity:0.8; font-size:0.85rem">
          <span>24 Hour Temperature Trend</span>
          <span>Next Day &rarr;</span>
        </div>
        <svg id="sparkline" class="sparkline" viewBox="0 0 100 30" preserveAspectRatio="none"></svg>
      </div>
    </main>

    <div id="placeholder" class="glass-card animate__animated animate__fadeIn" style="text-align:center; padding:50px;">
      <h3 style="font-weight:300; font-size:1.5rem">Welcome to Everything Lanka Weather</h3>
      <p style="opacity:0.7; margin-top:10px">Select a district above or use your location to see the magic.</p>
    </div>

    <footer>¬© 2025 Everything Lanka | Powered by Open-Meteo</footer>
  </div>

  <script>
    // --- CONFIGURATION ---
    const districts = {
      "Colombo": [6.9271,79.8612], "Gampaha": [7.0843,79.9400], "Kalutara": [6.5858,79.9680],
      "Kandy": [7.2906,80.6337], "Matale": [7.4667,80.6333], "Nuwara Eliya": [6.9497,80.7895],
      "Galle": [6.0535,80.2210], "Matara": [5.9488,80.5357], "Hambantota": [6.1240,81.1180],
      "Jaffna": [9.6615,80.0255], "Kilinochchi": [9.3833,80.4167], "Mannar": [8.9833,79.9333],
      "Vavuniya": [8.7578,80.5036], "Mullaitivu": [9.2667,80.7667], "Trincomalee": [8.5877,81.2152],
      "Batticaloa": [7.7240,81.6780], "Ampara": [7.2906,81.6675], "Monaragala": [6.8929,81.3407],
      "Badulla": [6.9933,81.0555], "Ratnapura": [6.6828,80.3996], "Kegalle": [7.3386,80.3410],
      "Anuradhapura": [8.3114,80.4037], "Polonnaruwa": [7.9407,81.0010], "Puttalam": [8.0368,79.8200], "Kurunegala": [7.4869,80.3633]
    };

    const el = id => document.getElementById(id);
    setInterval(() => { el('clock').textContent = new Date().toLocaleTimeString(); }, 1000);

    // --- BUTTONS ---
    el('getWeatherBtn').addEventListener('click', () => {
      const dist = el('districts').value;
      if(districts[dist]) fetchWeather(districts[dist][0], districts[dist][1], dist);
    });

    el('geoBtn').addEventListener('click', () => {
      if(navigator.geolocation) {
        el('geoBtn').innerHTML = '‚è≥';
        navigator.geolocation.getCurrentPosition(pos => {
          fetchWeather(pos.coords.latitude, pos.coords.longitude, "Your Location");
          el('geoBtn').innerHTML = 'üìç';
        }, () => { alert("Location denied."); el('geoBtn').innerHTML = 'üìç'; });
      } else alert("Geo not supported");
    });

    // --- FETCH ---
    async function fetchWeather(lat, lon, label) {
      el('placeholder').style.display = 'none';
      el('weatherContainer').style.display = 'block';
      el('wDesc').textContent = 'Loading...';
      
      try {
        // Request strict variables
        const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,is_day,precipitation,weather_code,wind_speed_10m&hourly=temperature_2m,precipitation_probability&daily=sunrise,sunset&timezone=Asia%2FColombo&forecast_days=1`;
        
        const res = await fetch(url);
        if(!res.ok) throw new Error("API Error");
        const data = await res.json();
        
        updateUI(data, label);
      } catch (e) {
        console.error(e);
        el('wDesc').textContent = 'Connection Error';
      }
    }

    // --- UPDATE UI ---
    function updateUI(data, label) {
      const curr = data.current; 
      const hourly = data.hourly;
      const daily = data.daily;
      
      el('wTemp').textContent = Math.round(curr.temperature_2m);
      el('wLoc').textContent = label;
      el('wWind').innerHTML = `${curr.wind_speed_10m} <small>km/h</small>`;
      el('wFeels').textContent = `${Math.round(curr.apparent_temperature)}¬∞`;
      el('wHum').textContent = `${curr.relative_humidity_2m}%`;
      el('wRain').textContent = `${hourly.precipitation_probability[0]}%`;

      const formatTime = (iso) => {
        if(!iso) return '--:--';
        return new Date(iso).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
      };
      el('wSunrise').textContent = formatTime(daily.sunrise[0]);
      el('wSunset').textContent = formatTime(daily.sunset[0]);

      // SAFE CODE EXTRACTION
      const code = curr.weather_code !== undefined ? curr.weather_code : 0;
      const isDay = curr.is_day;

      // GET TEXT
      const details = getWeatherDetails(code);
      el('wDesc').textContent = details.t; // Should show "Clear Sky", "Rain", etc.
      el('wIcon').textContent = details.i;
      
      // ANIMATE ICON
      el('wIcon').classList.remove('animate__rubberBand');
      void el('wIcon').offsetWidth; 
      el('wIcon').classList.add('animate__rubberBand');

      setTheme(code, isDay);
      drawSparkline(hourly.temperature_2m);
    }

    // --- THEME ---
    function setTheme(code, isDay) {
      document.body.className = ''; 
      if (isDay === 0 && code < 50) return document.body.classList.add('theme-night');
      
      if (code <= 3) document.body.classList.add(isDay ? 'theme-clear' : 'theme-night');
      else if (code <= 48) document.body.classList.add('theme-cloudy');
      else if (code >= 95) document.body.classList.add('theme-thunder');
      else document.body.classList.add('theme-rain');
    }

    // --- FULL WMO MAPPING (FIXED) ---
    function getWeatherDetails(code) {
      const map = {
        0: {t:'Clear Sky', i:'‚òÄÔ∏è'},
        1: {t:'Mainly Clear', i:'üå§Ô∏è'},
        2: {t:'Partly Cloudy', i:'‚õÖ'},
        3: {t:'Overcast', i:'‚òÅÔ∏è'},
        45: {t:'Foggy', i:'üå´Ô∏è'},
        48: {t:'Rime Fog', i:'üå´Ô∏è'},
        51: {t:'Light Drizzle', i:'üå¶Ô∏è'},
        53: {t:'Drizzle', i:'üå¶Ô∏è'},
        55: {t:'Heavy Drizzle', i:'üåßÔ∏è'},
        56: {t:'Freezing Drizzle', i:'‚ùÑÔ∏è'},
        57: {t:'Freezing Drizzle', i:'‚ùÑÔ∏è'},
        61: {t:'Slight Rain', i:'üåßÔ∏è'},
        63: {t:'Rainy', i:'üåßÔ∏è'},
        65: {t:'Heavy Rain', i:'üåßÔ∏è'},
        66: {t:'Freezing Rain', i:'‚ùÑÔ∏è'},
        67: {t:'Freezing Rain', i:'‚ùÑÔ∏è'},
        71: {t:'Snow Fall', i:'‚ùÑÔ∏è'},
        73: {t:'Snow Fall', i:'‚ùÑÔ∏è'},
        75: {t:'Heavy Snow', i:'‚ùÑÔ∏è'},
        77: {t:'Snow Grains', i:'‚ùÑÔ∏è'},
        80: {t:'Showers', i:'üå¶Ô∏è'},
        81: {t:'Heavy Showers', i:'üåßÔ∏è'},
        82: {t:'Violent Showers', i:'‚õàÔ∏è'},
        85: {t:'Snow Showers', i:'‚ùÑÔ∏è'},
        86: {t:'Snow Showers', i:'‚ùÑÔ∏è'},
        95: {t:'Thunderstorm', i:'‚õàÔ∏è'},
        96: {t:'Thunderstorm & Hail', i:'‚õàÔ∏è'},
        99: {t:'Thunderstorm & Hail', i:'‚õàÔ∏è'}
      };
      return map[code] || {t:'Unknown Weather', i:'üå°Ô∏è'};
    }

    // --- SPARKLINE ---
    function drawSparkline(temps) {
      if(!temps || !temps.length) return;
      const data = temps.slice(0, 24);
      const min = Math.min(...data), max = Math.max(...data), range = max - min || 1;
      const points = data.map((t, i) => `${(i/23)*100},${30 - ((t-min)/range)*30}`).join(' ');
      el('sparkline').innerHTML = `<polyline class="spark-line" points="${points}" /><polygon class="spark-fill" points="${points} 100,35 0,35" />`;
    }
  </script>
</body>
</html>
 




